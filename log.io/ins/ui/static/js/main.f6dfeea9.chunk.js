(this["webpackJsonplog.io-ui"]=this["webpackJsonplog.io-ui"]||[]).push([[0],{17:function(e,t,n){},34:function(e,t,n){e.exports=n(75)},67:function(e,t){},72:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){"use strict";n.r(t);var s=n(0),r=n.n(s),c=n(31),a=n.n(c),u=n(1),i="BIND_INPUT_TO_SCREEN",o="BIND_SOURCE_TO_SCREEN",m="BIND_STREAM_TO_SCREEN",l="UNBIND_INPUT_FROM_SCREEN",p="UNBIND_SOURCE_FROM_SCREEN",f="UNBIND_STREAM_FROM_SCREEN",d="ENSURE_INPUT",b="PING",g="REMOVE_INPUT",E="ADD_SCREEN",v="REMOVE_SCREEN",O=function(e,t){if(""!==t&&"#"!==t){var n={};try{n=JSON.parse(decodeURI(t.slice(1)))}catch(s){return console.warn("Unable to parse previous screen state:",t),void e({type:E})}Object.keys(n).forEach((function(t){e({type:E,screenId:t}),n[t].forEach((function(n){var s=n.split("|"),r=Object(u.a)(s,2),c=r[0],a=r[1];e({type:d,inputName:n,stream:c,source:a}),e({type:i,inputName:n,stream:c,source:a,screenId:t})}))}))}else e({type:E})},N=Object(s.createContext)(null),h=Object(s.createContext)(null),y=function(e){if(!e)return"nosignal";var t=(new Date).getTime()-e;if(t<1e4){var n=Math.floor(t/1e3);return"active".concat(n)}return"inactive"},k=(n(17),function(e){var t=e.dispatch,n=e.input,c=e.labelName,a=e.state,u=a.bindings,o=a.screens,m=Object(s.useMemo)((function(){return function(e,t){return!!u.inputs[e]&&!!u.inputs[e][t]}}),[u]),p=Object(s.useMemo)((function(){return function(e,n,s,r){m(e,r)?t({type:l,inputName:e,stream:n,source:s,screenId:r}):t({type:i,inputName:e,stream:n,source:s,screenId:r})}}),[t,m]);return function(e){var t=e.input,n=e.isBound,s=e.labelName,c=e.screens,a=e.toggleInputBinding,u=t.name,i=y(t.ping);return r.a.createElement("div",{className:"input"},r.a.createElement("div",{className:"diode ".concat(i)}),r.a.createElement("label",null,s),Object.keys(c.screens).map((function(e,s){return r.a.createElement("input",{key:e,title:"Screen ".concat(s+1),"data-testid":"input-control-".concat(u,":").concat(s),type:"checkbox",checked:n(u,e),onChange:function(){return a(u,t.stream,t.source,e)}})})))}({input:n,isBound:m,labelName:c,screens:o,toggleInputBinding:p})}),j=function(e){var t=e.input,n=e.labelName,r=Object(s.useContext)(N),c=Object(s.useContext)(h);return r&&c?k({dispatch:r,input:t,labelName:n,state:c}):null},S=function(e){var t=e.filter,n=e.groupType,s=e.inputState,c=e.isBound,a=e.screens,u=e.toggleBinding,i=s[n],o=Object.keys(i).map((function(e){return{name:e,group:i[e]}}));return""!==t.trim()&&(o=o.filter((function(e){return e.name.toLowerCase().includes(t.trim().toLowerCase())}))),r.a.createElement("div",{className:"input-groups"},o.map((function(e){var t=e.name,o=e.group;return r.a.createElement("div",{className:"input-group",key:t},r.a.createElement("div",{className:"input-group-name"},r.a.createElement("div",{className:"diode ".concat(y(o.ping))}),r.a.createElement("label",null,t),r.a.createElement("div",{className:"screen-binding-controls"},Object.keys(a.screens).map((function(e,s){return r.a.createElement("input",{key:"".concat(t,"-").concat(e),title:"Screen ".concat(s+1),"data-testid":"group-control-".concat(t,":").concat(s),type:"checkbox",checked:c(n,t,e),onChange:function(){return u(n,t,e)}})})))),Object.keys(i[t].pairs).map((function(e){return r.a.createElement(j,{key:s.inputs[i[t].pairs[e]].name,input:s.inputs[i[t].pairs[e]],labelName:e})})))})))},I=function(e){var t=e.dispatch,n=e.state,c=n.bindings,a=n.inputs,i=n.screens,l=Object(s.useMemo)((function(){return function(e,t,n){return!!c[e][t]&&!!c[e][t][n]}}),[c]),d=Object(s.useMemo)((function(){return function(e,n,s){switch(e){case"streams":l(e,n,s)?t({type:f,stream:n,screenId:s}):t({type:m,stream:n,screenId:s});break;case"sources":l(e,n,s)?t({type:p,source:n,screenId:s}):t({type:o,source:n,screenId:s})}}}),[t,l]);return function(e){var t=e.inputs,n=e.isBound,c=e.screens,a=e.toggleBinding,i=Object(s.useState)("streams"),o=Object(u.a)(i,2),m=o[0],l=o[1],p=Object(s.useState)(""),f=Object(u.a)(p,2),d=f[0],b=f[1];return r.a.createElement("div",{className:"input-manager"},r.a.createElement("div",{className:"input-group-toggles"},r.a.createElement("div",{className:"input-group-toggle ".concat("streams"===m?"active":""),onClick:function(){return l("streams")}},"Streams"),r.a.createElement("div",{className:"input-group-toggle ".concat("sources"===m?"active":""),onClick:function(){return l("sources")}},"Sources")),r.a.createElement("div",{className:"input-filter"},r.a.createElement("input",{type:"text",value:d,onChange:function(e){return b(e.target.value)},placeholder:"Filter..."})),r.a.createElement(S,{filter:d,groupType:m,inputState:t,isBound:n,screens:c,toggleBinding:a}))}({inputs:a,isBound:l,screens:i,toggleBinding:d})},C=function(){var e=Object(s.useContext)(N),t=Object(s.useContext)(h);return e&&t?I({dispatch:e,state:t}):null},_=n(4),w={inputs:{},screens:{},sources:{},streams:{}},M=function(e,t,n){e.inputs[t]||(e.inputs[t]={}),e.screens[n]||(e.screens[n]={inputs:{},streams:{},sources:{}}),e.inputs[t][n]=!0,e.screens[n].inputs[t]=!0},R=function(e,t,n){var s=e.inputs,r=e.screens;s[t]&&delete s[t][n],r[n]&&delete r[n].inputs[t]},B=function(e,t,n,s,r){Object.keys(t.streams[s].pairs).map((function(e){return t.streams[s].pairs[e]})).every((function(t){return(e.inputs[t]||{})[r]}))&&(e.streams[s]||(e.streams[s]={}),e.streams[s][r]=!0)},x=function(e,t,n,s,r){Object.keys(t.sources[n].pairs).map((function(e){return t.sources[n].pairs[e]})).every((function(t){return(e.inputs[t]||{})[r]}))&&(e.sources[n]||(e.sources[n]={}),e.sources[n][r]=!0)},D=Object(_.a)((function(e,t,n){switch(n.type){case i:var s=n.inputName,r=n.screenId,c=n.source,a=n.stream;M(e,s,r),B(e,t,0,a,r),x(e,t,c,0,r);break;case l:var u=n.inputName,b=n.screenId,g=n.source,E=n.stream;R(e,u,b),e.streams[E]&&delete e.streams[E][b],e.sources[g]&&delete e.sources[g][b];break;case m:var O=n.stream,N=n.screenId,h=t.streams[O].pairs;Object.keys(h).forEach((function(n){M(e,h[n],N),x(e,t,n,0,N)})),e.streams[O]||(e.streams[O]={}),e.streams[O][N]=!0;break;case f:var y=n.stream,k=n.screenId,j=t.streams[y].pairs;Object.keys(j).forEach((function(t){R(e,j[t],k),e.sources[t]&&delete e.sources[t][k]})),e.streams[y]&&delete e.streams[y][k];break;case o:var S=n.source,I=n.screenId,C=t.sources[S].pairs;Object.keys(C).forEach((function(n){M(e,C[n],I),B(e,t,0,n,I)})),e.sources[S]||(e.sources[S]={}),e.sources[S][I]=!0;break;case p:var _=n.source,w=n.screenId,D=t.sources[_].pairs;Object.keys(D).forEach((function(t){R(e,D[t],w),e.streams[t]&&delete e.streams[t][w]})),e.sources[_]&&delete e.sources[_][w];break;case v:var T=n.screenId,U=e.screens[T]||{};Object.keys(U.inputs||{}).forEach((function(t){e.inputs[t]&&delete e.inputs[t][T]})),Object.keys(U.streams||{}).forEach((function(t){e.streams[t]&&delete e.streams[t][T]})),Object.keys(U.sources||{}).forEach((function(t){e.sources[t]&&delete e.sources[t][T]})),delete e.screens[T];break;case d:var A=n.inputName,F=n.stream,L=n.source;e.sources[L]&&!t.inputs[A]&&Object.keys(e.sources[L]).forEach((function(t){delete e.sources[L][t]})),e.streams[F]&&!t.inputs[A]&&Object.keys(e.streams[F]).forEach((function(t){delete e.streams[F][t]}))}})),T={inputs:{},streams:{},sources:{}},U=Object(_.a)((function(e,t){var n=e.inputs,s=e.streams,r=e.sources;switch(t.type){case b:var c=t.inputName,a=t.stream,u=t.source,i=(new Date).getTime();n[c].ping=i,s[a].ping=i,r[u].ping=i;break;case d:var o=t.inputName,m=t.stream,l=t.source;n[o]||(n[o]={name:o,ping:null,stream:m,source:l},s[m]||(s[m]={ping:null,pairs:{}}),r[l]||(r[l]={ping:null,pairs:{}}),s[m].pairs[l]=o,r[l].pairs[m]=o);break;case g:var p=t.inputName,f=t.stream,E=t.source;delete s[f].pairs[E],delete r[E].pairs[f],delete n[p]}})),A=n(7),F=n(15),L="ADD_MESSAGE",P="CLEAR_MESSAGES",J={screens:{}},G=function(e,t,n){var s=e.screens;switch(n.type){case L:var r=n.inputName,c=n.msg,a=Object(F.a)({},s),i=t.inputs[r]||{};return Object.keys(i).forEach((function(e){if(i[e]){var t=r.split("|"),n=Object(u.a)(t,2),o=n[0],m=n[1],l="[".concat(o,"] [").concat(m,"] - ").concat(c),p=(s[e]||[]).concat([l]);p.length>1e4+Math.floor(200)&&(p=p.slice(-1e4)),a[e]=p}})),{screens:a};case P:return{screens:Object(F.a)({},s,Object(A.a)({},n.screenId,[]))};default:return e}},V=n(32),q=n.n(V),z=function(e,t){e.emit("+activate",t)},H=function(e,t){e.emit("-activate",t)},K=function(e,t,n){var s=t.bindings,r=t.inputs;switch(n.type){case m:Object.keys(r.streams[n.stream].pairs).forEach((function(t){z(e,r.streams[n.stream].pairs[t])}));break;case f:Object.keys(r.streams[n.stream].pairs).forEach((function(t){var c=r.streams[n.stream].pairs[t];Object.keys(s.inputs[c]).some((function(e){return s.inputs[c][e]}))||H(e,c)}));break;case o:Object.keys(r.sources[n.source].pairs).forEach((function(t){z(e,r.sources[n.source].pairs[t])}));break;case p:Object.keys(r.sources[n.source].pairs).forEach((function(t){var c=r.sources[n.source].pairs[t];Object.keys(s.inputs[c]).some((function(e){return s.inputs[c][e]}))||H(e,c)}));break;case i:z(e,n.inputName);break;case l:Object.keys(s.inputs[n.inputName]).some((function(e){return s.inputs[n.inputName][e]}))||H(e,n.inputName);break;case v:if(!s.screens[n.screenId])return;Object.keys(s.screens[n.screenId].inputs).forEach((function(t){Object.keys(s.inputs[t]).some((function(e){return s.inputs[t][e]}))||H(e,t)}))}},Q=function(e,t,n){var s=t.bindings;switch(n.type){case m:case f:case o:case p:case i:case l:case v:var r={};Object.keys(s.screens).forEach((function(e){r[e]=Object.keys(s.screens[e].inputs).filter((function(t){return s.screens[e].inputs[t]}))})),window.location.hash=JSON.stringify(r)}},W={screens:{}};var X=Object(_.a)((function(e,t){var n=e.screens;switch(t.type){case E:var s=t.screenId||String((new Date).valueOf());n[s]={id:s,messages:[]};break;case v:var r=t.screenId;r&&delete n[r]}})),Y=function(e,t){var n=e.bindings,s=e.inputs,r=e.messages,c=e.screens,a=e.socket,u={bindings:D(n,s,t),inputs:U(s,t),messages:G(r,n,t),screens:X(c,t),socket:a};return K(a,u,t),Q(a,u,t),u},Z=n(33),$=(n(72),function(e){var t=e.message,n=e.messageFilter;return r.a.createElement("div",null,n&&function(e,t){for(var n=[],s=0,r=0,c=e.toLowerCase(),a=t.toLowerCase();s<e.length;){var u=s+t.length;c.substring(s,u)===a&&(n.push({highlight:!1,text:e.slice(r,s)}),n.push({highlight:!0,text:e.slice(s,u)}),s=u,r=u),s+=1}return n.push({highlight:!1,text:e.slice(r,e.length)}),n}(t,n).map((function(e,t){return r.a.createElement("span",{key:t,className:e.highlight?"highlight":""},e.text)})),!n&&t)}),ee=function(e){var t=e.clearMessages,n=e.messages,c=e.removeScreen,a=e.screen,i=e.screenIndex,o=Object(s.useState)(""),m=Object(u.a)(o,2),l=m[0],p=m[1],f=Object(s.useState)(n),d=Object(u.a)(f,2),b=d[0],g=d[1];return Object(s.useEffect)((function(){g(n.filter((function(e){return""===l||e.toLowerCase().includes(l.toLowerCase())})))}),[n,l]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"screen-header"},r.a.createElement("div",{className:"title"},"Screen ",i+1),r.a.createElement("div",{className:"controls"},r.a.createElement(Z.DebounceInput,{minLength:2,debounceTimeout:200,placeholder:"Filter",onChange:function(e){return p(e.target.value)}}),r.a.createElement("button",{onClick:function(){return t(a.id)}},"Clear"),r.a.createElement("button",{onClick:function(){return c(a.id)}},"Close"))),r.a.createElement("div",{className:"screen","data-testid":"screen-".concat(i)},r.a.createElement("div",{className:"screen-messages"},b.map((function(e,t){return r.a.createElement($,{key:t,message:e,messageFilter:l})})))))},te=function(e){var t=e.dispatch,n=e.state,c=n.messages,a=n.screens,u=Object(s.useMemo)((function(){return function(){t({type:E})}}),[t]),i=Object(s.useMemo)((function(){return function(e){t({type:v,screenId:e})}}),[t]);return function(e){var t=e.addScreen,n=e.clearMessages,s=e.messages,c=e.removeScreen,a=e.screens,u=Object.keys(a.screens);return r.a.createElement("div",{className:"screens"},u.map((function(e,t){return r.a.createElement(ee,{key:e,clearMessages:n,removeScreen:c,screen:a.screens[e],screenIndex:t,messages:s.screens[e]||[]})})),r.a.createElement("div",{className:"screens-controls"},u.length<6&&r.a.createElement("button",{"data-testid":"add-screen-btn",className:"add-screen-btn",onClick:t},"\uff0b Add Screen")))}({addScreen:u,clearMessages:Object(s.useMemo)((function(){return function(e){t({type:P,screenId:e})}}),[t]),messages:c,removeScreen:i,screens:a})},ne=function(){var e=Object(s.useContext)(h),t=Object(s.useContext)(N);return e&&t?te({dispatch:t,state:e}):null},se=(n(73),function(e){var t=e.initialState,n=e.socket,c=Object(s.useReducer)(Y,t),a=Object(u.a)(c,2),i=a[0],o=a[1];return Object(s.useEffect)((function(){return function(e,t){e.on("+input",(function(e){var n=e.inputName,s=e.stream,r=e.source;t({type:d,inputName:n,stream:s,source:r})}))}(n,o)}),[o,n]),Object(s.useEffect)((function(){return function(e,t){e.on("-input",(function(e){var n=e.inputName,s=e.stream,r=e.source;t({type:g,inputName:n,stream:s,source:r})}))}(n,o)}),[o,n]),Object(s.useEffect)((function(){return function(e,t){e.on("+ping",(function(e){var n=e.inputName,s=e.stream,r=e.source;t({type:d,inputName:n,stream:s,source:r}),t({type:b,inputName:n,stream:s,source:r})}))}(n,o)}),[o,n]),Object(s.useEffect)((function(){return function(e,t){e.on("+msg",(function(e){var n=e.inputName,s=e.msg;t({type:L,inputName:n,msg:s})}))}(n,o)}),[o,n]),Object(s.useEffect)((function(){return O(o,window.location.hash)}),[o,n]),r.a.createElement(N.Provider,{value:o},r.a.createElement(h.Provider,{value:i},r.a.createElement("div",{className:"app"},r.a.createElement("div",{className:"left-column"},i&&r.a.createElement(C,null)),r.a.createElement("div",{className:"right-column"},i&&r.a.createElement(ne,null)))))});n(74);a.a.render(r.a.createElement((function(){var e=q()(),t=function(e){return{bindings:w,inputs:T,messages:J,screens:W,socket:e}}(e);return r.a.createElement(se,{socket:e,initialState:t})}),null),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.f6dfeea9.chunk.js.map